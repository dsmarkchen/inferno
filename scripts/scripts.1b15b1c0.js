"use strict";angular.module("infernoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(t,e){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/inferno/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/inferno/main",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/inferno/tx",{templateUrl:"views/tx.html",controller:"TxCtrl",controllerAs:"tx"}).when("/tx",{templateUrl:"views/tx.html",controller:"TxCtrl",controllerAs:"tx"}).when("/inferno/rx",{templateUrl:"views/rx.html",controller:"RxCtrl",controllerAs:"rx"}).when("/rx",{templateUrl:"views/rx.html",controller:"RxCtrl",controllerAs:"rx"}).otherwise({redirectTo:"/"})}]),angular.module("infernoApp").filter("split",function(){return function(t){var e=t.split(/([!,.;?-])/g),r="",l="",n="";return e.forEach(function(t){if(r+=t,52<t.length){return r.split(/(that|where|which|when|who)/g).forEach(o),l+=n,void(r="")}((l+=t).endsWith("--")&&"-"==t||"?"==t||";"==t||"."==t||"!"==t||","==t)&&(l+="\n",r="")}),console.log("line_index:0"),l;function o(t){if("that"==t||"where"==t||"when"==t||"who"==t||"which"==t)return n+="\n ",void(n+=t);n+=t}}}).controller("MainCtrl",["$scope","$location",function(t,e){var r,l;t.txTotalSymbols=localStorage.getItem("totalSymbols"),t.txTotalLHs=localStorage.getItem("totalLHs"),t.rxTotalSymbols=localStorage.getItem("rxTotalSymbols"),t.rxTotalLHs=localStorage.getItem("rxTotalLHs"),t.isActive=function(t){return t===e.path()},t.ie=(r=window.navigator.userAgent,0<(l=r.indexOf("MSIE"))?parseInt(r.substring(l+5,r.indexOf(".",l))):navigator.userAgent.match(/Trident\/7\./)?11:0)}]),angular.module("infernoApp").filter("myCantoFilter",function(){return function(t,e){var r=[];if(""==e)return t;var l=e.split(/[,:]/),n=l[0],o=l[1],i=l[2];return angular.forEach(t,function(t){t.name.trim()==n.trim()&&t.line>=o&&t.line<i&&r.push(t)}),r}}).controller("RxCtrl",["$scope","$http",function(o,t){o.isNullOrEmpty=function(t){return null==t||""===t},o.rxTotalSymbols=60,o.rxTotalLHs=1,o.myQuery=localStorage.getItem("myQuery"),o.isNullOrEmpty(o.myQuery)&&(o.myQuery="1:1,25",localStorage.setItem("myQuery",o.myQuery)),localStorage.setItem("rxTotalSymbols",o.rxTotalSymbols),localStorage.setItem("rxTotalLHs",o.rxTotalLHs);var l=0,n=[];o.cantoes=[];var i="";t.get("https://dsmarkchen.github.io/inferno/inferno.txt").then(function(t){o.inferno=t.data.split(/\r?\n/),o.inferno.forEach(o.buildone),0<n.length&&o.cantoes.push({line:l-1,text:n.join("<br>")})});var a=3;o.move=function(){var t=o.myQuery;if(""!=t){var e=t.split(/[,:]/),r=e[0].trim(),l=parseInt(e[1].trim(),10),n=parseInt(e[2].trim(),10);n+=a,(l+=a)<0&&(l=1),o.myQuery=r+":"+l.toString()+","+n.toString(),localStorage.setItem("myQuery",o.myQuery)}},o.prev=function(){a=-3,o.move()},o.next=function(){a=3,o.move()},o.buildone=function(t,e){if(0<t.trim().length){if(/^##/.test(t))return 0<n.length&&(o.cantoes.push({name:i,line:l,text:n.join("<br>"),visible:!0}),n=[]),i=t.replace(/^## /,""),void(l=0);var r=t.replace(/--/g,"&#x2012;");n.push(r.trim()),l++,3==n.length&&(o.cantoes.push({name:i,line:l-2,text:n.join("<br>"),visible:!0}),n=[])}}}]),angular.module("infernoApp").controller("TxCtrl",["$scope","fileReader",function(r,t){r.visible=!1,r.parseCSV=function(t,e){var r=t.split(/\r\n|\r|\n/g);for(var l in r){for(var n,o=r[l].split(e=e||","),i=o.length-1;0<=i;i--)'"'==o[i].replace(/"\s+$/,'"').charAt(o[i].length-1)?1<(n=o[i].replace(/^\s+"/,'"')).length&&'"'==n.charAt(0)?o[i]=o[i].replace(/^\s*"|"\s*$/g,"").replace(/""/g,'"'):i?o.splice(i-1,2,[o[i-1],o[i]].join(e)):o=o.shift().split(e).concat(o):o[i].replace(/""/g,'"');r[l]=o}return r},r.getFile=function(){r.progress=0,r.textSrc="",r.totalSymbols=0,r.totalLHs=0,localStorage.setItem("totalSymbols",r.totalSymbols),localStorage.setItem("totalLHs",r.totalLHs),t.readAsText(r.file,r).then(function(t){r.textSrc=t,r.lines=r.parseCSV(t,","),r.lines.forEach(function(t){/LH/.test(t)&&(r.totalSymbols+=t.length-4,r.totalLHs++)}),localStorage.setItem("totalSymbols",r.totalSymbols),localStorage.setItem("totalLHs",r.totalLHs),console.log(typeof t),console.log(typeof r.textSrc)})},r.$on("fileProgress",function(t,e){r.progress=e.loaded/e.total})}]).directive("ngFileSelect",function(){return{link:function(e,t){t.bind("change",function(t){e.file=(t.srcElement||t.target).files[0],e.getFile()})}}}).factory("fileReader",["$q","$log",function(l,t){t.log("fileReader");return{readAsText:function(t,e){var r=l.defer();return function(t,e){var r=new FileReader;return r.onload=function(t,e,r){return function(){r.$apply(function(){e.resolve(t.result)})}}(r,t,e),r.onerror=function(t,e,r){return function(){r.$apply(function(){e.reject(t.result)})}}(r,t,e),r.onprogress=function(t,e){return function(t){e.$broadcast("fileProgress",{total:t.total,loaded:t.loaded})}}(0,e),r}(r,e).readAsText(t),r.promise}}}]),angular.module("infernoApp").run(["$templateCache",function(t){t.put("views/main.html",'<div class="jumbotron jumbotron-fluid"> <div class="container"> <div class="block"> <h1 class="animated fadeInUp">Inferno</h1> <div ng-hide="ie == 0"> <p class="animated fadeInUp">IE {{ie}}</p> </div> </div> </div> </div> <div class="container"> <p> <strong> Summary </strong> </p> <table class="table table-striped"> <tr> <th> </th> <th> Tx</th> <th> Rx</th> <th> Percentage</th> </tr> <tr> <td> symbols </td> <td>{{txTotalSymbols}} </td> <td>{{rxTotalSymbols}} </td> <td>{{rxTotalSymbols /txTotalSymbols * 100 | number : 2}} </td> </tr> <tr><td> sequences </td> <td> {{txTotalLHs}} </td> <td> {{rxTotalLHs}} </td> <td> {{rxTotalLHs/txTotalLHs * 100 | number : 2}} </td> </tr> </table> </div> '),t.put("views/rx.html",'<div class="container"> <div class="row"> <div class="col-md-3 col-sm-12"> <form> <div class="form-group"> <div class="input-group"> <div class="input-group-addon"><i class="fa fa-search"></i></div> <input type="text" class="form-control" placeholder="query: start, end" ng-model="myQuery"> </div> </div> </form> <button class="btn btn-secondary" ng-click="prev()"> prev</button> <button class="btn btn-secondary" ng-click="next()"> next</button> </div> <div class="col-md-9 col-sm-12"> <div ng-repeat="linex in cantoes | myCantoFilter: myQuery  track by $index "> <div class="row" ng-if="linex.visible"> <div class="col-2"> <p class="line">{{linex.name}}:{{linex.line}} </p> </div> <div class="col-10"> <div class="block"> <p class="canto" ng-bind-html="linex.text"></p> </div> </div> </div> </div> </div> </div> </div> '),t.put("views/tx.html",'<div class="container"> <form> <div class="row"> <div class="col-md-12"> <input type="file" ng-file-select="onFileSelect($files)" class="form-control-file border"> </div> </div> </form> <br> <b>Statistics:</b><br> <table class="table table-striped"> <tr> <th>Name</th> <th>Counts </th> </tr> <tr> <td>Total Symbols </td> <td>{{totalSymbols}}</td> </tr> <tr> <td>Total Sequences </td> <td>{{totalLHs}}</td> </tr> </table> <b>Preview:</b> <input ng-model="visible" type="checkbox"> <br> <i ng-hide="textSrc">No text file choosed</i> <pre ng-show="visible">{{textSrc}}</pre> <br> <b>Progress:</b> <progress value="{{progress}}"></progress> </div> ')}]);